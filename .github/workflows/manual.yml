name: Python Workflow

on:
  schedule:
    - cron: "16 10 * * *" # Runs every day at 10:06 UTC
  workflow_dispatch: # Allows manual triggering of the workflow

jobs:
  python_workflow:
    runs-on: ubuntu-latest

    steps:
    - name: Install Python packages from all requirements.txt files
      run: |
        python -m pip install --upgrade pip
        for script in $(find . -name '*.txt'); do
          pip install "$script" &
        done
        wait
        echo "All requirements installed"
        
    - name: Execute Python scripts
      run: |
        echo "Starting Python scripts execution"
        for script in $(find . -name 'main.py'); do
          python "$script" &
        done
        wait
        echo "All Python scripts executed"
        
    - name: Move processed file with proper naming
      run: |
        if [ -f "filtered_articles.csv" ]; then
          mv filtered_articles.csv processed_files/bbc_articles_$(date +\%Y-\%m-\%d).csv
          echo "Moved filtered_articles.csv to processed_files directory"
        else
          echo "No filtered_articles.csv found, skipping move"
        fi
  
    - name: Commit and push changes to repository
      run: |
        if [ -f "processed_files/bbc_articles_$(date +\%Y-%m-%d).csv" ]; then
          git config --local user.email "haibt0206@gmail.com"
          git config --local user.name "thehaibui"
          git add processed_files/
          git commit -m "Save processed articles for $(date +%Y-%m-%d)"
          git push
          echo "Changes committed and pushed"
        else
          echo "Processed CSV not found, skipping git commit and push"
        fi
